<!DOCTYPE html>
<html lang="es">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras - IDYMAN</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: url('7f222312b94457464ec0bf446fcad1ec.jpg') no-repeat center center fixed;
            background-size: cover;
            color: white;
            text-align: center;
        }

        .cart-container {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
            width: 80%;
            margin: 20px auto;
            color: black;
        }

        button {
            background: linear-gradient(to right, #2E8B57, #3CB371);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(46, 139, 87, 0.8);
        }

        /* Estilos del modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            text-align: center;
            padding-top: 100px;
        }

        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            width: 40%;
            margin: auto;
            color: black;
        }

        .modal-content input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .close {
            color: red;
            font-size: 20px;
            float: right;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="cart-container">
        <h2>Tu selecci√≥n de macetas</h2>
        <div id="cart-items"></div>
        <p id="cart-total"></p>
        <button onclick="location.href='index.html'">Principal</button>
        <button onclick="openModal()" class="pay-cart">Proceder al Pago</button>
        <button onclick="generatePDF()" class="download-pdf">Descargar PDF</button>

        <div id="loading-container">
            <div class="loading-circle"></div>
        </div>
    </div>

    <!-- Modal de pago -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>üí≥ Informaci√≥n de Pago</h2>
            <input type="text" id="cardNumber" placeholder="N√∫mero de Tarjeta">
            <input type="password" id="nip" placeholder="NIP">
            <select id="cardType">
                <option value="Visa">Visa</option>
                <option value="MasterCard">MasterCard</option>
                <option value="American Express">American Express</option>
            </select>
            <br><br>
            <button onclick="processPayment()">Realizar Pago</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            const cartContainer = document.getElementById("cart-items");
            let total = 0;

            if (cart.length === 0) {
                cartContainer.innerHTML = "<p>üõçÔ∏è No hay productos en tu carrito.</p>";
                return;
            }

            cart.forEach((item, index) => {
                total += item.price * item.quantity;
                const itemDiv = document.createElement("div");
                itemDiv.innerHTML = `
                    <p><strong>${item.name}</strong><br>
                    üìè Tama√±o: ${item.size}<br>
                    üé® Color: ${item.color}<br>
                    üí∞ Precio: MXN$${item.price.toFixed(2)} x ${item.quantity} = <strong>MXN$${(item.price * item.quantity).toFixed(2)}</strong><br>
                    <button onclick="removeItem(${index})" class="delete-btn">Eliminar</button>
                    </p><hr>`;
                cartContainer.appendChild(itemDiv);
            });

            document.getElementById("cart-total").textContent = `Total general: MXN$${total.toFixed(2)}`;
        });

        function openModal() {
            document.getElementById("paymentModal").style.display = "block";
        }

        function closeModal() {
            document.getElementById("paymentModal").style.display = "none";
        }

        function processPayment() {
            let cardNumber = document.getElementById("cardNumber").value;
            let nip = document.getElementById("nip").value;
            let cardType = document.getElementById("cardType").value;
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);

            if (cardNumber === "" || nip === "") {
                alert("‚ö†Ô∏è Por favor, completa todos los campos.");
                return;
            }

            let paymentDetails = {
                cardNumber,
                nip,
                cardType,
                total,
                items: cart
            };

            localStorage.setItem("paymentDetails", JSON.stringify(paymentDetails));

            alert("‚úÖ Pago realizado con √©xito con " + cardType + "!");
            closeModal();
        }

        function generatePDF() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let content = "üõí Informaci√≥n del Carrito de Compras\n\n";

            if (cart.length === 0) {
                content += "No hay productos en el carrito.\n";
            } else {
                cart.forEach((item, index) => {
                    content += `${index + 1}. ${item.name}\n`;
                    content += `üìè Tama√±o: ${item.size}\n`;
                    content += `üé® Color: ${item.color}\n`;
                    content += `üí∞ Precio: MXN$${item.price.toFixed(2)} x ${item.quantity} = MXN$${(item.price * item.quantity).toFixed(2)}\n\n`;
                });

                content += `Total: MXN$${cart.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2)}\n`;
            }

            doc.text(content, 10, 10);
            doc.save("Carrito_IDYMAN.pdf");
        }
    </script>
</body>
</html>
